apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    kompose.cmd: kompose convert
    kompose.version: 1.25.0 (a70f80cc)
  creationTimestamp: null
  labels:
    io.kompose.service: server-pcd-dev
  name: server-pcd-dev
spec:
  replicas: 1
  selector:
    matchLabels:
      io.kompose.service: server-pcd-dev
  strategy: {}
  template:
    metadata:
      annotations:
        kompose.cmd: kompose convert
        kompose.version: 1.25.0 (a70f80cc)
      creationTimestamp: null
      labels:
        io.kompose.service: server-pcd-dev
    spec:
      containers:
        - image: renci/icees-api-server:0.5.0
          name: trapi-v1-pcd-dev-server
          ports:
            - containerPort: 8080
          env:
           - name: ICEES_PORT
             value: "5432"
           - name: ICEES_HOST
             valueFrom:
               secretKeyRef:
                 name: pcd-config
                 key: ICEES_HOST       
           - name: ICEES_DBUSER 
             valueFrom:
               secretKeyRef:
                 name: pcd-config
                 key: ICEES_DBUSER
           - name: ICEES_DBPASS
             valueFrom:
               secretKeyRef:      
                 name: pcd-config
                 key: ICEES_DBPASS
           - name: POSTGRES_PASSWORD 
             valueFrom:
               secretKeyRef:      
                 name: pcd-config
                 key: POSTGRES_PASSWORD
           - name: ICEES_DATABASE
             valueFrom:
               secretKeyRef:      
                 name: pcd-config
                 key: ICEES_DATABASE
           - name: ICEES_API_LOG_PATH
             value: "/var/log"
           - name: ICEES_API_HOST_PORT
             value: "8080"
           - name: POOL_SIZE
             value: "10"
           - name: MAX_OVERFLOW
             value: "0"
           - name: OPENAPI_TITLE 
             value: "ICEES PCD Instance API"
           - name: OPENAPI_HOST
             value: "iceesapi-pcd-dev.apps.renci.org"
           - name: OPENAPI_SCHEME
             value: "https"
           - name: DATA_PATH
             value: "./db/data"
           - name: DB_PATH
             value: "/iceesdata/pcd/sqlite/example.db"
           - name: CONFIG_PATH 
             value: "/iceesdata/pcd/config"
           - name: ICEES_API_INSTANCE_NAME
             value: "trapi-v1.2-pcd-dev"
           - name: OPENAPI_SERVER_URL
             value: "https://iceesapi-pcd-dev.apps.renci.org"
           - name: ICEES_INFORES_CURIE 
             value: "infores:icees-pcd"
           - name: OPENAPI_SERVER_MATURITY
             value: "development"
           - name: OPENAPI_SERVER_LOCATION
             value: "RENCI"
          volumeMounts:
            - name: iceesdata          
              mountPath: /iceesdata
          resources: 
            requests: 
              cpu: "1"
              memory: 8Gi    
            limits:
              memory: "10Gi"
              cpu: "2"   
              
      restartPolicy: Always
      volumes:
        - name: iceesdata
          persistentVolumeClaim:
            claimName: iceesdata
